<app-navigation />

<main class="container">
  <section class="banner">
    <div class="banner-inner">
      <div>
        <div class="title">Charity & Causes events</div>
        <div class="sub-title">Welcome — together, we can make a difference.</div>
        <div class="sub-title">Discover the best Charity & Causes events in your area and online</div>
      </div>
      <img class="charity-img" src="/images/charity_and_causes.webp" alt="Charity And Causes" />
    </div>
  </section>

  <section class="charity-and-causes">
    <a class="btn" href="/" style="margin-bottom: 12px; display:inline-block;">Back to Home</a>

    <div *ngIf="showLoading" id="loading" class="notice">Loading event…</div>
    <div *ngIf="showNotFound" id="notfound" class="notice">Event not found.</div>

    <article *ngIf="event" id="detail" class="card">
      <div id="banner">
        <img id="img" class="thumb" [src]="event!.image_url" [alt]="event!.name">
      </div>

      <div class="card-body">
        <div class="meta" style="margin-bottom:6px;">
          <span id="status" class="badge badge-{{getStatus(event)}}">{{getStatus(event)}}</span>
          <span id="when">{{ event!.start_datetime | date:'medium'  }}</span>
          <span id="where">{{ event!.location_city || '-' }}</span>
        </div>

        <h1 id="title" class="title" style="font-size:22px;">{{event!.name}}</h1>

        <p id="shortdesc" class="muted" style="margin:6px 0 10px;">{{event!.short_description}}</p>

        <div id="desc" style="margin: 8px 0 10px; white-space: pre-line;">{{event!.description}}</div>

        <div class="meta" style="margin-top:10px;flex-direction: column;font-size: 16px;">
          <div><b>Venue: </b> <span id="venue">{{event!.location_venue}}</span></div>
          <div><b>Address: </b> <span id="address">{{event!.address_line}}</span></div>
          <div><b>Ticket: </b> <span id="price">{{event!.ticket_price | currency}}</span></div>
          <div><b>Goal: </b> <span id="goal">{{event!.goal_amount | currency}}</span></div>
          <div><b>Raised: </b> <span id="progress">{{event!.progress_amount | currency}}</span></div>

          <div class="progress-container">
            <div id="progress-bar" class="progress-bar" [style.width]="(event!.goal_amount > 0 ? (event!.progress_amount / event!.goal_amount * 100).toFixed(2) : 0) + '%'"></div>
          </div>
          <p id="progress-text" class="progress-text">Progress: {{(event!.goal_amount > 0 ? (event!.progress_amount / event!.goal_amount * 100).toFixed(2) : 0)}}% of goal reached</p>

        </div>

        <div style="margin-top:12px;">
          <button id="btn-register" class="btn" type="button" (click)="register()">Register</button>
        </div>
      </div>
    </article>
  </section>

  <!-- Registrations list -->
  <section *ngIf="event" id="registrations" class="charity-and-causes">
    <div class="card">
      <h2 class="title" style="font-size:18px; margin-bottom:8px;">All Registrations</h2>

      <div *ngIf="event.registrations?.length === 0" class="notice">No registrations yet.</div>

      <div *ngIf="event.registrations?.length">
        <div class="table" role="table" style="width:100%; overflow:auto;">
          <div class="thead" role="row">
            <div>Name</div>
            <div>Email</div>
            <div>Tickets</div>
            <div>Paid</div>
            <div>Registered At</div>
          </div>

          <div class="tbody" role="rowgroup">
            <div *ngFor="let r of event.registrations" role="row">
              <div>{{ r.full_name }}</div>
              <div>{{ r.email }}</div>
              <div>{{ r.tickets_qty }}</div>
              <div>{{ r.amount_paid | currency }}</div>
              <div>{{ r.registration_datetime | date:'medium' }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</main>
